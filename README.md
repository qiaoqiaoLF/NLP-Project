# NLP-Project
This is the repository for the project of CS3602-AI

## Training

```bash
sh scripts/train.sh
```

You can customize your own scripts.

## Code interpretation

### Each Example in the train set

#### Original Data

```
[
    [
        {
            "utt_id": 1,
            "manual_transcript": "导航到凯里大十字",
            "asr_1best": "导航到凯里大十字",
            "semantic": [
                [
                    "inform",
                    "操作",
                    "导航"
                ],
                [
                    "inform",
                    "终点名称",
                    "凯里大十字"
                ]
            ]
        },
        {
            "utt_id": 2,
            "manual_transcript": "第二个",
            "asr_1best": "第二个",
            "semantic": [
                [
                    "inform",
                    "序列号",
                    "第二个"
                ]
            ]
        }
    ],
```

It is the first dialogue in the orignal data, containing two sentences.

#### Converted to two "Example"s

Example0-0:  

```
ex: {'utt_id': 1, 'manual_transcript': '导航到凯里大十字', 'asr_1best': '导航到凯里大十字', 'semantic': [['inform', '操作', '导航'], ['inform', '终点名称', '凯里大十字']]}
did: '0-0'
utt: '导航到凯里大十字' (From 'asr_1best')
slot: {'inform-操作': '导航', 'inform-终点名称': '凯里大十字'}
tags: ['B-inform-操作', 'I-inform-操作', 'O', 'B-inform-终点名称', 'I-inform-终点名称', 'I-inform-终点名称', 'I-inform-终点名称', 'I-inform-终点名称']
slotvalue: ['inform-操作-导航', 'inform-终点名称-凯里大十字']
self.input_idx: [2, 3, 4, 5, 6, 7, 8, 9]
self.tag_id:  [30, 31, 1, 14, 15, 15, 15, 15]
```

Example0-1:  

```
ex: {'utt_id': 2, 'manual_transcript': '第二个', 'asr_1best': '第二个', 'semantic': [['inform', '序列号', '第二个']]}
did: '0-1'
utt: '第二个' (From 'asr_1best')
slot: {'inform-序列号': '第二个'}
tags: ['B-inform-序列号', 'I-inform-序列号', 'I-inform-序列号']
slotvalue: ['inform-序列号-第二个']
self.input_idx: [10, 11, 12]
self.tag_id:  [32, 33, 33]
```

#### In a batch together with other examples

(IN REAL CASES, EXAMPLES MAY BE SHUFFLED)
(The examples within a batch is sorted according to their length to accelerate rnn.)

Batch:

```
examples: [Example13-0, Example9-4 ...]
did: ['13-0', '9-4', '1-0', '3-0', '17-0', '0-0', '9-2', '16-0', '4-1', '15-0', '18-1', '20-0', '2-0', '4-2', '7-0', '9-1', '14-0', '8-0', '11-0', '4-0', '6-0', '10-0', '0-1', '9-0', '9-3', '14-1', '18-2', '5-0', '12-0', '15-1', '18-0', '19-0']
utt: ['去闵行区纪翟路八百八十八号', '我去新郑市八千乡人民政府', '导航重庆师范大学图书馆', '导航到左权县科目一考场', '导航凯迪拉克四S店', '导航到凯里大十字', '返程新郑市八千乡', '导航罗汉洞收费站', '嘉祥县人民政府', '导航到红会医院', '查找附近的酒店', '我要去退太原市', '我现在在哪里', '我要去第一个', '导航柳开馨苑', '新郑市八千乡', '导航到文晖苑', '一口客运站', '导航张家口', '导航一下', '语音导航', '放中医院', '第二个', '请装饰', '嗨叮咚', '第一个', '有什么', '导航', '导航', '一个', '导航', '导航']
input_ids[5]: [2, 3, 4, 5, 6, 7, 8, 9, 0, 0, 0, 0, 0] (padded) 
lengths: [13, 12, 11, 11, 9, 8, 8, 8, 7, 7, 7, 7, 6, 6, 6, 6, 6, 5, 5, 4, 4, 4, 3, 3, 3, 3, 3, 2, 2, 2, 2, 2]
labels: [['inform-终点名称-闵行区纪翟路八百八十八号'], ['inform-终点名称-新郑市八千乡人民政府'], ['inform-操作-导航', 'inform-终点名称-重庆师范大学图书馆'], ['inform-操作-导航', 'inform-终点名称-左权县科目一考场'], ['inform-操作-导航', 'inform-终点名称-凯迪拉克四s店'], ['inform-操作-导航', 'inform-终点名称-凯里大十字'], ['inform-终点名称-新郑市八千乡'], ['inform-操作-导航', 'inform-终点名称-罗汉洞收费站'], ['inform-poi名称-嘉祥县人民政府'], ['inform-操作-导航', 'inform-终点名称-红会医院'], ['inform-操作-查找', 'inform-请求类型-附近', 'inform-poi目标-酒店'], ['inform-终点名称-太原市'], [], ['inform-序列号-第一个'], ['inform-操作-导航', 'inform-终点名称-柳开馨苑'], ['inform-poi名称-新郑市八千乡'], ['inform-操作-导航', 'inform-终点名称-文晖苑'], ['inform-poi名称-营口客运站'], ['inform-操作-导航', 'inform-终点名称-张家口'], ['inform-操作-导航'], ['inform-操作-导航'], ['inform-poi名称-中医院'], ['inform-序列号-第二个'], [], [], ['inform-序列号-第一个'], [], ['inform-操作-导航'], ['inform-操作-关闭', 'inform-对象-导航'], [], ['inform-操作-导航'], ['inform-操作-导航']]
tag_ids: tensor([[ 1, 14, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15],
        [ 1,  1, 14, 15, 15, 15, 15, 15, 15, 15, 15, 15,  0],
        [30, 31, 14, 15, 15, 15, 15, 15, 15, 15, 15,  0,  0],
        [30, 31,  1, 14, 15, 15, 15, 15, 15, 15, 15,  0,  0],
        [30, 31,  1,  1,  1,  1,  1,  1,  1,  0,  0,  0,  0],
        [30, 31,  1, 14, 15, 15, 15, 15,  0,  0,  0,  0,  0],
        [ 1,  1, 14, 15, 15, 15, 15, 15,  0,  0,  0,  0,  0],
        [30, 31, 14, 15, 15, 15, 15, 15,  0,  0,  0,  0,  0],
        [ 2,  3,  3,  3,  3,  3,  3,  0,  0,  0,  0,  0,  0],
        [30, 31,  1, 14, 15, 15, 15,  0,  0,  0,  0,  0,  0],
        [30, 31, 22, 23,  1,  6,  7,  0,  0,  0,  0,  0,  0],
        [ 1,  1,  1,  1, 14, 15, 15,  0,  0,  0,  0,  0,  0],
        [ 1,  1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0],
        [ 1,  1,  1, 32, 33, 33,  0,  0,  0,  0,  0,  0,  0],
        [30, 31, 14, 15, 15, 15,  0,  0,  0,  0,  0,  0,  0],
        [ 2,  3,  3,  3,  3,  3,  0,  0,  0,  0,  0,  0,  0],
        [30, 31,  1, 14, 15, 15,  0,  0,  0,  0,  0,  0,  0],
        [ 1,  1,  1,  1,  1,  0,  0,  0,  0,  0,  0,  0,  0],
        [30, 31, 14, 15, 15,  0,  0,  0,  0,  0,  0,  0,  0],
        [30, 31,  1,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0],
        [ 1,  1, 30, 31,  0,  0,  0,  0,  0,  0,  0,  0,  0],
        [ 1,  2,  3,  3,  0,  0,  0,  0,  0,  0,  0,  0,  0],
        [32, 33, 33,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
        [ 1,  1,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
        [ 1,  1,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
        [32, 33, 33,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
        [ 1,  1,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
        [30, 31,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
        [28, 29,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
        [ 1,  1,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
        [30, 31,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0],
        [30, 31,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0]])
tag_mask: tensor([[1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1.],
        [1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 0.],
        [1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 0., 0.],
        [1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 0., 0.],
        [1., 1., 1., 1., 1., 1., 1., 1., 1., 0., 0., 0., 0.],
        [1., 1., 1., 1., 1., 1., 1., 1., 0., 0., 0., 0., 0.],
        [1., 1., 1., 1., 1., 1., 1., 1., 0., 0., 0., 0., 0.],
        [1., 1., 1., 1., 1., 1., 1., 1., 0., 0., 0., 0., 0.],
        [1., 1., 1., 1., 1., 1., 1., 0., 0., 0., 0., 0., 0.],
        [1., 1., 1., 1., 1., 1., 1., 0., 0., 0., 0., 0., 0.],
        [1., 1., 1., 1., 1., 1., 1., 0., 0., 0., 0., 0., 0.],
        [1., 1., 1., 1., 1., 1., 1., 0., 0., 0., 0., 0., 0.],
        [1., 1., 1., 1., 1., 1., 0., 0., 0., 0., 0., 0., 0.],
        [1., 1., 1., 1., 1., 1., 0., 0., 0., 0., 0., 0., 0.],
        [1., 1., 1., 1., 1., 1., 0., 0., 0., 0., 0., 0., 0.],
        [1., 1., 1., 1., 1., 1., 0., 0., 0., 0., 0., 0., 0.],
        [1., 1., 1., 1., 1., 1., 0., 0., 0., 0., 0., 0., 0.],
        [1., 1., 1., 1., 1., 0., 0., 0., 0., 0., 0., 0., 0.],
        [1., 1., 1., 1., 1., 0., 0., 0., 0., 0., 0., 0., 0.],
        [1., 1., 1., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
        [1., 1., 1., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
        [1., 1., 1., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
        [1., 1., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
        [1., 1., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
        [1., 1., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
        [1., 1., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
        [1., 1., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
        [1., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
        [1., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
        [1., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
        [1., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.],
        [1., 1., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.]])
```

#### Forward Process

From input_ids (batch) to logits.  
IT IS EASY YET IMPORTANT. PLEASE CHECK IT OUT YOURSELF.

#### Decode Process

From input_ids (batch) to predictions.
IT IS EASY. PLEASE CHECK IT OUT YOURSELF.

### label_vocab

It is built from the acts and slots in ./data/ontology.json
```
{'<pad>': 0, 'O': 1, 'B-inform-poi名称': 2, 'I-inform-poi名称': 3, 'B-inform-poi修饰': 4, 'I-inform-poi修饰': 5, 'B-inform-poi目标': 6, 'I-inform-poi目标': 7, 'B-inform-起点名称': 8, 'I-inform-起点名称': 9, 'B-inform-起点修饰': 10, 'I-inform-起点修饰': 11, 'B-inform-起点目标': 12, 'I-inform-起点目标': 13, 'B-inform-终点名称': 14, 'I-inform-终点名称': 15, 'B-inform-终点修饰': 16, 'I-inform-终点修饰': 17, 'B-inform-终点目标': 18, 'I-inform-终点目标': 19, 'B-inform-途经点名称': 20, 'I-inform-途经点名称': 21, 'B-inform-请求类型': 22, 'I-inform-请求类型': 23, 'B-inform-出行方式': 24, 'I-inform-出行方式': 25, 'B-inform-路线偏好': 26, 'I-inform-路线偏好': 27, 'B-inform-对象': 28, 'I-inform-对象': 29, 'B-inform-操作': 30, 'I-inform-操作': 31, 'B-inform-序列号': 32, 'I-inform-序列号': 33, 'B-inform-页码': 34, 'I-inform-页码': 35, 'B-inform-value': 36, 'I-inform-value': 37, 'B-deny-poi名称': 38, 'I-deny-poi名称': 39, 'B-deny-poi修饰': 40, 'I-deny-poi修饰': 41, 'B-deny-poi目标': 42, 'I-deny-poi目标': 43, 'B-deny-起点名称': 44, 'I-deny-起点名称': 45, 'B-deny-起点修饰': 46, 'I-deny-起点修饰': 47, 'B-deny-起点目标': 48, 'I-deny-起点目标': 49, 'B-deny-终点名称': 50, 'I-deny-终点名称': 51, 'B-deny-终点修饰': 52, 'I-deny-终点修饰': 53, 'B-deny-终点目标': 54, 'I-deny-终点目标': 55, 'B-deny-途经点名称': 56, 'I-deny-途经点名称': 57, 'B-deny-请求类型': 58, 'I-deny-请求类型': 59, 'B-deny-出行方式': 60, 'I-deny-出行方式': 61, 'B-deny-路线偏好': 62, 'I-deny-路线偏好': 63, 'B-deny-对象': 64, 'I-deny-对象': 65, 'B-deny-操作': 66, 'I-deny-操作': 67, 'B-deny-序列号': 68, 'I-deny-序列号': 69, 'B-deny-页码': 70, 'I-deny-页码': 71, 'B-deny-value': 72, 'I-deny-value': 73}
```

### word_vocab

It is built from the manual_transcript in ./data/train.json
```
{'<pad>': 0, '<unk>': 1, '导': 2, '航': 3, '到': 4, '凯': 5, '里': 6, '大': 7, '十': 8, '字': 9, '第': 10, '二': 11, '个': 12, '重': 13, '庆': 14, '师': 15, '范': 16, '学': 17, '图': 18, '书': 19, '馆': 20, '我': 21, '现': 22, '在': 23, '哪': 24, '左': 25, '权': 26, '县': 27, '科': 28, '目': 29, '一': 30, '考': 31, '场': 32, '下': 33, '嘉': 34, '祥': 35, '人': 36, '民': 37, '政': 38, '府': 39, '要': 40, '去': 41, '语': 42, '音': 43, '柳': 44, '开': 45, '馨': 46, '苑': 47, '营': 48, '口': 49, '客': 50, '运': 51, '站': 52, '(': 53, 'u': 54, 'n': 55, 'k': 56, 'o': 57, 'w': 58, ')': 59, '新': 60, '郑': 61, '市': 62, '八': 63, '千': 64, '乡': 65, '返': 66, '程': 67, '嗨': 68, '叮': 69, '咚': 70, '中': 71, '医': 72, '院': 73, '张': 74, '家': 75, '关': 76, '闭': 77, '闵': 78, '行': 79, '区': 80, '纪': 81, '翟': 82, '路': 83, '百': 84, '号': 85, '文': 86, '晖': 87, '红': 88, '会': 89, '罗': 90, '汉': 91, '洞': 92, '收': 93, '费': 94, '迪': 95, '拉': 96, '克': 97, '四': 98, 's': 99, '店': 100, ...... , '噻': 1727, '竹': 1728, '垃': 1729, '圾': 1730, '扎': 1731, '彬': 1732, '宇': 1733, '织': 1734, '垦': 1735, '刷': 1736, '牙': 1737, '映': 1738, '芙': 1739, '蓉': 1740}
```
